name: Add Compiler Label on Issue/PR create

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]
  

jobs:
  create_label_workflow:
    uses: ./.github/workflows/create_label.yml

  jai_version_workflow:
    uses: ./.github/workflows/jai_version.yml
    
  add_compiler_label:
    runs-on: [self-hosted, windows]
    needs: [ create_label_workflow, jai_version_workflow]
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Add Compiler Label
      uses: actions/github-script@v7
      with:
        script: |
          const issue_number = context.payload.issue
            ? context.payload.issue.number
            : context.payload.pull_request.number;
        
          await github.rest.issues.addLabels({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: issue_number,
            labels: [ "${{ needs.jai_version_workflow.outputs.version }}" ]
          });
